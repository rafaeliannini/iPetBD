<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iPet Avaliação</title>
  <link rel="icon" href="../imagens/logoPet.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="../style.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<body>
    <header class="container-fluid">
        <div class="d-flex flex-column flex-md-row align-items-center">
          <a href="../index.html"><img src="../imagens/logoPet.png" width="130px" height="100px" alt="Logo" class="me-3"></a>
          <nav class="d-flex flex-column flex-md-row justify-content-between w-100">
            <ul class="nav flex-column flex-md-row">
              <li class="nav-item">
                <a id="corT" class="nav-link fw-bold fs-5 fs-md-2" href="../cadastroProduto/produto.html">Produtos</a>
              </li>
              <li class="nav-item">
                <a id="corT" class="nav-link fw-bold fs-5 fs-md-2" href="../cadastroLocal/local.html">Lazer</a>
              </li>
              <li class="nav-item">
                <a id="corT" class="nav-link fw-bold fs-5 fs-md-2" href="../cadastroServicos/servicos.html">Serviços</a>
              </li>
              <li class="nav-item">
                <a id="corT" class="nav-link fw-bold fs-5 fs-md-2" href="../cadastroEventos/evento.html">Eventos</a>
              </li>
              <li class="nav-item">
                <a id="corT" class="nav-link fw-bold fs-5 fs-md-2" href="../IA/avaliacaoIA.html">Avaliação de Local</a>
              </li>
            </ul>
            <ul class="nav flex-column flex-md-row">
              <li class="nav-item">
                <a id="logarLink" class="nav-link text-light rounded-4 px-3 fs-5 fs-md-4 fw-bold" href="../login/signup/loginForm.html" style="background-color: #d6660a;">Logar</a>
              </li>
              <li class="nav-item mt-2 mt-md-0 ms-md-2">
                <a id="inscreverLink" class="nav-link text-light rounded-4 px-3 fs-5 fs-md-4 fw-bold" href="../login/signup/cadastroForm.html" style="background-color: #d6660a;">Se inscrever</a>
              </li>
              <li class="nav-item mt-2 mt-md-0 ms-md-2">
                <a id="contaIcon" class="nav-link text-light rounded-4 px-3 fs-5 fs-md-4 fw-bold" href="../login/signup/perfil.html" style="background-color: #d6660a;">Conta</a>
              </li>
            </ul>
          </nav>
        </div>
        <hr style="border-top: 2px solid black; width: 100%; margin-top: 0px;">
      </header>

      <section id="Avaliacao" class="container mt-5 d-flex justify-content-center align-items-center flex-column">
        <div class="text-center">
          <h1>Avaliação de Locais</h1>
          <form id="avaliacaoForm" class="mt-4">
            <div class="mb-3">
              <label for="nomeLocal" class="form-label">Nome do Local</label>
              <input type="text" class="form-control text-center" id="nomeLocal" placeholder="Digite o nome do local" required>
            </div>
            <div class="mb-3">
              <label for="linkImagem" class="form-label">Link da Imagem</label>
              <input type="url" class="form-control text-center" id="linkImagem" placeholder="Cole o link da imagem" required>
            </div>
            <button type="submit" class="btn text-light fw-bold" style="background-color: #d6660a;">Avaliar</button>
          </form>
    
          <div id="resultado" class="mt-4" style="display: none;">
            <h3>Resultado</h3>
            <p id="detalhesAvaliacao"></p>
            <img id="imagemAvaliacao" src="" alt="Imagem do Local" class="img-fluid mt-3" />
          </div>
        </div>
      </section>

  <footer id="corB3" class="mt-5 p-5">
    <div class="container">
      <div class="row">
        <div class="col-md">
          <h6 class="mb-2">iPet</h6>
          <p class="text-light">iPet é uma plataforma que visa facilitar donos de pet a encontrarem lugar ideal para seu amigo de 4 patas.</p>
        </div>
        <div class="col-md">
          <h6 class="mb-2">Serviços</h6>
          <p class="text-light">Restaurantes<br>Lojas<br>Shoppings</p>
        </div>
        <div class="col-md">
          <h6 class="mb-2">Empresa</h6>
          <p class="text-light">Quem Somos<br>Nossa Equipe<br>Contato</p>
        </div>
        <div class="col-md" style="flex: 3;">
          <h6 class="mb-6">Receba Notícias</h6>
          <form id="meuFormulario" action="#" method="post" class="d-flex">
            <input style="height: 40px;" type="email" id="email" class="form-control me-1" placeholder="Seu e-mail" aria-label="Seu e-mail" aria-describedby="button-addon2" required>
            <button style="margin: 0 !important; font-size: 11px !important; width: 30%;" id="corB" class="btn ms-1 mt-3 me-0 text-light rounded-2 fs-6 fw-bold" type="submit">Se Inscrever</button>
          </form>
          <div style="display: flex; justify-content: end;">
            <a style="text-decoration: none;" href="https://www.instagram.com/ipetoficialbh/" target="_blank">
              <img style="height: 50px; margin-top: 10px;" src="../imagens/instagram.png" alt="Instagram">
            </a>
            <a style="text-decoration: none;" href="https://www.x.com/ipetoficial/" target="_blank">
              <img style="height: 50px; margin-top: 10px;" src="../imagens/twitter.png" alt="Twitter">
            </a>
          </div>
        </div>
      </div>
    </div>
    <hr style="border-top: 2px solid white; width: 100%; margin-top: 0px;">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center" style="color: white">
      <p class="mb-0 me-md-5">Copyright iPet</p>
      <div class="d-flex align-items-center">
        <img src="../imagens/logoPet.png" width="100px" height="80px" alt="Logo">
      </div>
    </div>
  </footer>
  <style>
    #imagemAvaliacao {
    width: 550px;
    height: 412px;
    object-fit: cover; 
  }
  </style>
  <script>
    const API_URL = "https://ipetcustomvision-prediction.cognitiveservices.azure.com/customvision/v3.0/Prediction/94d6564f-f169-4587-a2fe-bdd956c77bb9/classify/iterations/Iteration1/url";
    const PREDICTION_KEY = "9tiYuiw4lAMWVMOaXiSxaIX8RO45p6Xka04QHaYXPPlWUypMIqv0JQQJ99AKACYeBjFXJ3w3AAAIACOGaaAo";

    document.getElementById("avaliacaoForm").addEventListener("submit", async function (event) {
      event.preventDefault();

      const nomeLocal = document.getElementById("nomeLocal").value;
      const linkImagem = document.getElementById("linkImagem").value;

      if (!nomeLocal || !linkImagem) {
        alert("Por favor, preencha todos os campos!");
        return;
      }

      const resultadoDiv = document.getElementById("resultado");
      const detalhesAvaliacao = document.getElementById("detalhesAvaliacao");
      const imagemAvaliacao = document.getElementById("imagemAvaliacao");

      imagemAvaliacao.src = linkImagem;

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Prediction-Key": PREDICTION_KEY,
          },
          body: JSON.stringify({ Url: linkImagem }),
        });

        const result = await response.json();

        if (response.ok) {
          const predictions = result.predictions;
          const topPrediction = predictions[0];
          const tagName = topPrediction.tagName; 
          const confidence = (topPrediction.probability * 100).toFixed(2);

          let comentario = '';
          if (confidence > 80) {
            if (tagName === "Otimo") {
              comentario = "Provavelmente, o local apresenta excelentes condições de limpeza e organização. É altamente recomendado!";
            } else if (tagName === "Medio") {
              comentario = "Provavelmente, o local está em condições razoáveis, mas pode melhorar em alguns aspectos de limpeza ou organização.";
            } else if (tagName === "Ruim") {
              comentario = "Provavelmente, os níveis de limpeza e organização do local estão insatisfatórios. Recomendamos atenção ao visitar.";
            }
          } else {
            comentario = "Os resultados não são conclusivos. Recomendamos uma análise mais detalhada ou a consideração de outras informações antes de tomar uma decisão sobre este local.";
          }

          resultadoDiv.style.display = "block";
          detalhesAvaliacao.innerHTML = `
            O local <strong>${nomeLocal}</strong> foi avaliado como: <strong>${tagName}</strong> 
            com uma confiança de <strong>${confidence}%</strong>.
            <br>
            ${comentario ? `<p>${comentario}</p>` : ""}
          `;
        } else {
          throw new Error("Erro na API: " + result.message);
        }
      } catch (error) {
        resultadoDiv.style.display = "block";
        detalhesAvaliacao.innerHTML = `
          <p class="text-danger">Houve um erro ao processar sua solicitação: ${error.message}</p>
        `;
      }
    });
  </script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const usuarioId = localStorage.getItem('usuarioId');
        if (usuarioId) {
            document.getElementById('logarLink').style.display = 'none';
            document.getElementById('inscreverLink').style.display = 'none';
            document.getElementById('contaIcon').style.display = 'block';
        } else {
            document.getElementById('contaIcon').style.display = 'none';
        }
    });
</script>
</body>

</html>
